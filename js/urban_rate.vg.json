{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "background": "beige",
  "data": {
    "url": "https://raw.githubusercontent.com/rizlanhkm/FIT3179_a2/refs/heads/main/csv_data/malaysia_urbanization_rate.csv"
  },
  "vconcat": [
    {
      "title": "Urban vs Non-urban population in Malaysia (%)",
      "width": 300,
      "height": 300,
      "layer": 
      [ 
        {
          "mark": {"type": "arc", "innerRadius": 120},
          "transform": 
          [
            {"filter": "year(datum.Year) == Current_Year"}
          ],
          "encoding": {
            "theta": {"field": "value", "type": "quantitative"},
            "color": {"field": "Category", "type": "nominal"}
          }
        },
        {
          "mark": {
            "type": "text",
            "align": "center",
            "baseline": "middle",
            "dx": 0,
            "dy": 0,
            "fontSize": 35,
            "fontWeight": "bold"
          },
          "encoding": {
            "text": {"field": "text annotation %"},
            "x": {"signal": "width / 2"},
            "y": {"signal": "height / 2"}
          },
          "transform": 
          [
            {"filter": "(datum.Category == 'Percentage of Total Urban') && (year(datum.Year) == Current_Year)"}
          ]
        },
        {
          "mark": {
            "type": "text",
            "align": "center",
            "baseline": "middle",
            "dx": 0,
            "dy": -40,
            "fontSize": 20
          },
          "encoding": {
            "text": {"field": "text annotation year"},
            "x": {"signal": "width / 2"},
            "y": {"signal": "height / 2"}
          },
          "transform": 
          [
            {"filter": "(year(datum.Year) == Current_Year)"}
          ]
        },
        {
          "mark": {
            "type": "text",
            "align": "center",
            "baseline": "middle",
            "dx": 0,
            "dy": 40,
            "fontSize": 20,
            "fontWeight":"lighter"
          },
          "encoding": {
            "text": {"field": "text annotation live in"},
            "x": {"signal": "width / 2"},
            "y": {"signal": "height / 2"}
          }
        }
      ]
    },
    {
      "title": "Change in Malaysian urban population from previous year (%)",
      "width": 300,
      "height": 100,
      "mark": 
      {
        "type": "line",
        "point": 
        {
          "shape": "circle"
        }
      },
      "transform": 
      [
        {"filter": "year(datum.Year) <= Current_Year"}
      ],
      "encoding": {
        "x": 
        {
          "field": "Year",
          "type": "temporal",
          "title": "Year",
          "scale": {"domain": {"param": "Current_Year"}}
        },
        "y": 
        {
          "field": "Change from previous year (%)",
          "type": "quantitative",
          "title": "Change from previous year (%)"
        },
        "tooltip":
        [
          {"field": "Year", "type": "temporal", "timeUnit": "year"},
          {"field": "Change from previous year (%)", "type": "quantitative"}
        ]
      }
    }
  ],
  "params": [
    {
      "name": "Current_Year",
      "value": 2021,
      "bind": {
        "input": "range",
        "min": 1970,
        "max": 2021,
        "step": 1,
        "name": "Current Year"
      }
    }
  ],
  "transform": [
    {
      "fold": ["Percentage of Total Urban", "Percentage of Non-urban"],
      "as": ["Category", "value"]
    },
    {
      "calculate": "datum.value + '%'",
      "as": "text annotation %"
    },
    {
      "calculate": "'In ' + Current_Year + ','",
      "as": "text annotation year"
    },
    {
      "calculate": "'of Malaysians lived;in urban areas'",
      "as": "text annotation live in raw"
    },
    {
      "calculate": "split(datum['text annotation live in raw'], ';')",
      "as": "text annotation live in"
    }
  ]
}